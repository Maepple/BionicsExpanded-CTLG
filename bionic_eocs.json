[
  {
    "type": "effect_on_condition",
    "id": "EOC_BIO_dragon_breath_activated",
    "effect": [
      { "run_eocs": "EOC_check_user_input" },
      {
        "run_eocs": {
          "id": "EOC_input_validation",
          "condition": { 
            "or": [
              { "compare_string": [ { "u_val": "cur_gas_mode" }, "1" ] },
              { "compare_string": [ { "u_val": "cur_gas_mode" }, "2" ] },
              { "compare_string": [ { "u_val": "cur_gas_mode" }, "3" ] }
            ] 
          },
          "effect": [
            { "run_eocs": [ "EOC_set_cur_gas_reserve" ] },
            { "run_eoc_with": "EOC_check_reserve_intensity", "variables": { "effect_id": { "u_val": "cur_gas_reserve" } } },
            {
              "if": { "math": [ "u_cur_intensity", ">=", "5" ] },
              "then": { "math": [ "u_enough_in_reserve", "=", "true" ] },
              "else": { "math": [ "u_enough_in_reserve", "=", "false" ] }
            },
            {
              "if": { "math": [ "u_enough_in_reserve", "==", "true" ] },
              "then": [
                { "run_eoc_with": "mod_reserves", "variables": { "reserve_id": { "u_val": "cur_gas_reserve" }, "operation": "-=", "modifier": "5" } },
                {
                  "if": { "compare_string": [ { "u_val": "cur_gas_mode" }, "1" ] },
                  "then": { "set_string_var": "SPELL_DRAGON_BREATH_TEAR_GAS", "target_var": { "u_val": "cur_DB_spell" } }
                },
                {
                  "if": { "compare_string": [ { "u_val": "cur_gas_mode" }, "2" ] },
                  "then": { "set_string_var": "SPELL_DRAGON_BREATH_FUNGICIDE", "target_var": { "u_val": "cur_DB_spell" } }
                },
                {
                  "if": { "compare_string": [ { "u_val": "cur_gas_mode" }, "3" ] },
                  "then": { "set_string_var": "SPELL_DRAGON_BREATH_INSECTICIDE", "target_var": { "u_val": "cur_DB_spell" } }
                },
                { "u_cast_spell": { "id":  { "u_val": "cur_DB_spell" } }, "targeted": true }
              ],
              "else": [
                { "u_message": "Gas reserves are too low!" },
                { "run_eocs": "refund_power" }
              ]
            }
          ],
          "false_effect": [
            {
              "if": { "compare_string": [ { "u_val": "cur_gas_mode" }, "0" ] },
              "then": { "u_message": "Canceled." },
              "else": { "u_message": "<u_val:cur_gas_mode> is an invalid gas option!" }
            },
            { "run_eocs": "refund_power" }
          ]
        }
      } 
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BIO_VDA_activated",
    "effect": { "u_message": "not implemented" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BIO_VDA_deactivated",
    "effect": { "u_message": "not implemented" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BIO_chem_factory_activated",
    "effect": [
      {
        "set_string_var": "",
        "string_input": {
          "title": "Input an integer:",
          "description": "Chemical Factory Synthesis Menu\n- 1:Tear Gas\n- 2:Fungicide\n- 3:Insecticide\n- 4:Cancel Synthesis Order\n",
          "width": 40,
          "only_digits": true
        },
        "target_var": { "context_val": "str" }
      },
      { "run_eoc_with": "check_for_synth", "variables": { "request_num": { "context_val": "str" } } }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "check_for_synth",
    "condition": {
      "or": [ { "u_has_effect": "synth_tear_gas" }, { "u_has_effect": "synth_fungicide" }, { "u_has_effect": "synth_insecticide" } ]
    },
    "effect": {
      "run_eocs": {
        "id": "EOC_check_if_cancel_valid",
        "condition": { 
          "or": [
            { "compare_string": [ { "context_val": "request_num" }, "1" ] },
            { "compare_string": [ { "context_val": "request_num" }, "2" ] },
            { "compare_string": [ { "context_val": "request_num" }, "3" ] }
          ] 
        },
        "effect": [
          { "u_message": "You can't have multiple synthesis requests!" }, 
          { "run_eocs": "refund_power" }
        ],
        "false_effect": {
          "if": { "compare_string": [ { "context_val": "request_num" }, "4" ] },
          "then": [
            {  
              "foreach": "array",
              "var": { "context_val": "id" },
              "target": [ "synth_tear_gas", "synth_fungicide", "synth_insecticide" ],
              "effect": { "u_lose_effect": { "context_val": "id" } }
            },
            { "u_message": "You stop synthesizing chemicals." }
          ],
          "else": [
            { "u_message": "Invalid synthesis order!" },
            { "run_eocs": "refund_power" }
          ]
        }
      }
    },
    "false_effect": {
      "run_eocs": {
        "id": "EOC_check_if_new_synth_valid",
        "condition": {
          "or": [
            { "compare_string": [ { "context_val": "request_num" }, "1" ] },
            { "compare_string": [ { "context_val": "request_num" }, "2" ] },
            { "compare_string": [ { "context_val": "request_num" }, "3" ] }
          ]
        },
        "effect": [
          {
            "if": { "compare_string": [ { "context_val": "request_num" }, "1" ] },
            "then": [ { "u_add_effect": "synth_tear_gas", "duration": "PERMANENT" }, { "u_message": "You start synthesizing tear gas." } ]
          },
          {
            "if": { "compare_string": [ { "context_val": "request_num" }, "2" ] },
            "then": [ { "u_add_effect": "synth_fungicide", "duration": "PERMANENT" }, { "u_message": "You start synthesizing fungicide." } ]
          },
          {
            "if": { "compare_string": [ { "context_val": "request_num" }, "3" ] },
            "then": [
              { "u_add_effect": "synth_insecticide", "duration": "PERMANENT" },
              { "u_message": "You start synthesizing insecticide." }
            ]
          }
        ],
        "false_effect": [
          {
            "if": { "compare_string": [ { "context_val": "request_num" }, "4" ] },
            "then": { "u_message": "You don't have any synthesis order to cancel!" },
            "else": { "u_message": "Invalid synthesis order!" }
          },
          { "run_eocs": "refund_power" }
        ]
      }
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SYNTH_TEAR_GAS",
    "condition": {
      "or": [ { "math": [ "u_val('power')", "<=", "energy('10 kJ')" ] }, { "u_has_effect": "reserve_tear_gas", "intensity": 10 } ]
    },
    "effect": {
      "if": { "u_has_effect": "reserve_tear_gas", "intensity": 10 },
      "then": { "u_message": "Your tear gas reserves are full! Consider stopping synthesis." },
      "else": { "u_message": "You have insufficent power to produce tear gas! Consider stopping synthesis." }
    },
    "false_effect": [
      { "math": [ "u_val('power')", "-=", "energy('10 kJ')" ] },
      { "math": [ "u_health", "-=", "1" ] },
      { "run_eoc_with": "mod_reserves", "variables": { "reserve_id": "reserve_tear_gas", "operation": "+=", "modifier": "1" } }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SYNTH_FUNGICIDE",
    "condition": {
      "or": [ { "math": [ "u_val('power')", "<=", "energy('10 kJ')" ] }, { "u_has_effect": "reserve_fungicide", "intensity": 10 } ]
    },
    "effect": {
      "if": { "u_has_effect": "reserve_fungicide", "intensity": 10 },
      "then": { "u_message": "Your fungicide reserves are full! Consider stopping synthesis." },
      "else": { "u_message": "You have insufficent power to produce fungicide! Consider stopping synthesis." }
    },
    "false_effect": [
      { "math": [ "u_val('power')", "-=", "energy('10 kJ')" ] },
      { "math": [ "u_health", "-=", "1" ] },
      { "run_eoc_with": "mod_reserves", "variables": { "reserve_id": "reserve_fungicide", "operation": "+=", "modifier": "1" } }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SYNTH_INSECTICIDE",
    "condition": {
      "or": [ { "math": [ "u_val('power')", "<=", "energy('10 kJ')" ] }, { "u_has_effect": "reserve_insecticide", "intensity": 10 } ]
    },
    "effect": {
      "if": { "u_has_effect": "reserve_insecticide", "intensity": 10 },
      "then": { "u_message": "Your insecticide reserves are full! Consider stopping synthesis." },
      "else": { "u_message": "You have insufficent power to produce insecticide! Consider stopping synthesis." }
    },
    "false_effect": [
      { "math": [ "u_val('power')", "-=", "energy('10 kJ')" ] },
      { "math": [ "u_health", "-=", "1" ] },
      { "run_eoc_with": "mod_reserves", "variables": { "reserve_id": "reserve_insecticide", "operation": "+=", "modifier": "1" } }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "mod_reserves",
    "effect": [
      { "run_eoc_with": "EOC_check_reserve_intensity", "variables": { "effect_id": { "context_val": "reserve_id" } } },
      {
        "if": { "compare_string": [ { "context_val": "operation" }, "+=" ] },
        "then": [ 
          { "math": [ "u_cur_intensity", "+=", "_modifier" ] },  
          {
            "if": { "math": [ "u_cur_intensity", ">", "10" ] },
            "then": { "math": [ "u_cur_intensity", "=", "10" ] }
          }
        ],
        "else": [
          { "u_message": "<u_val:cur_intensity> ... <context_val:modifier>" },
          { "math": [ "u_cur_intensity", "-=", "_modifier" ] },
          { "u_message": "<u_val:cur_intensity>" },
          {
            "if": { "math": [ "u_cur_intensity", "<", "0" ] },
            "then": { "math": [ "u_cur_intensity", "=", "0" ] }
          } 
        ]
      },
      {
        "if": { "math": [ "u_cur_intensity", ">", "0" ] },
        "then": {
          "u_add_effect": { "context_val": "reserve_id" },
          "duration": "PERMANENT",
          "intensity": { "u_val": "cur_intensity" }
        },
        "else": { "u_lose_effect": { "context_val": "reserve_id" } }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_check_reserve_intensity",
    "effect": [
      {
        "foreach": "array",
        "var": { "context_val": "id" },
        "target": [ "1", "2", "3", "4", "5", "6", "7", "8", "9", "10" ],
        "effect": {
          "if": { "u_has_effect": { "context_val": "effect_id" }, "intensity": { "math": [ "_id" ] } },
          "then": [ { "math": [ "u_cur_intensity", "=", "" ] }, { "math": [ "u_cur_intensity", "=", "_id" ] } ]
        }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_check_user_input",
    "effect": [
      {
        "set_string_var": "",
        "string_input": {
          "title": "Input an integer:",
          "description": "- 1: Tear Gas\n- 2: Fungicide\n- 3: Insecticide",
          "width": 40,
          "only_digits": true
        },
        "target_var": { "context_val": "str" }
      },
      { "math": [ "u_cur_gas_mode", "=", "_str" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_set_cur_gas_reserve",
    "effect": [
      {
        "if": { "math": [ "u_cur_gas_mode", "==", "1" ] },
        "then": { "set_string_var": "reserve_tear_gas", "target_var": { "u_val": "cur_gas_reserve" } }
      },
      {
        "if": { "math": [ "u_cur_gas_mode", "==", "2" ] },
        "then": { "set_string_var": "reserve_fungicide", "target_var": { "u_val": "cur_gas_reserve" } }
      },
      {
        "if": { "math": [ "u_cur_gas_mode", "==", "3" ] },
        "then": { "set_string_var": "reserve_insecticide", "target_var": { "u_val": "cur_gas_reserve" } }
      }
    ]
  }
]
